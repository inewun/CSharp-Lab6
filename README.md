# Лабораторная работа №6: Интерфейсы и шаблоны ООП

Выполнил: Братчиков Геннадий

Группа: La3

## Описание проекта

Проект реализует лабораторную работу по объектно-ориентированному программированию на C#. Содержит две основные части:

**Задание 1: Кот** - Работа с интерфейсами, логированием и паттернами

**Задание 2: Дроби** - Работа с перегрузкой операторов, клонированием и кэшированием

Проект полностью документирован XML-комментариями и следует принципам Microsoft C# Coding Conventions.

---

## Структура проекта

### Основные файлы

**Program.cs** - Главная точка входа приложения.

**Главное меню** - Позволяет выбрать между двумя заданиями (Кошки/Дроби) или выход
- **Раздел "Кошки" (Case 1)**
  - Создание кота с валидацией имени
  - Демонстрация методов `Meow()` и `Meow(int times)`
  - Создание собаки для проверки интерфейса `IMeowable`
  - Работа с коллекцией мяукающих объектов через `Sounder.Meow()`
  - Вывод статистики через `MeowLogger`
- **Раздел "Дроби" (Case 2)**
  - Создание нескольких экземпляров дробей
  - Демонстрация всех арифметических операций (+, -, *, /)
  - Операции между дробью и целым числом
  - Цепочки методов: `Sum()`, `Minus()`, `Mult()`, `Div()`
  - Сравнение дробей через переопределённый `Equals()`
  - Клонирование дроби с `ICloneable`
  - Работа с кэшированным вещественным значением через `IFraction`

### Модуль Cat (Задание 1)

#### **IMeowable.cs**
Интерфейс для определения поведения мяукающих сущностей.

**Содержит:**
- `void Meow()` - Метод, который реализует мяуканье объекта

#### **Cat.cs**
Класс, представляющий кота.

**Свойства:**
- `string Name` - Имя кота (2-50 символов, только буквы и пробелы, с валидацией по regex)

**Конструкторы:**
- `Cat(string name)` - Создание кота с указанным именем

**Методы:**
- `void Meow()` - Выводит "{Имя}: мяу!"
- `void Meow(int times)` - Выводит "{Имя}: мяу-мяу-...-мяу!" (N раз)
- `string ToString()` - Возвращает "кот: {Имя}"

**Особенности:**
- Реализует интерфейс `IMeowable`
- Валидация имени на длину и формат
- Полная XML-документация

#### **Dog.cs**
Класс, представляющий собаку (аналог Cat для демонстрации полиморфизма).

**Свойства:**
- `string Name` - Имя собаки (2-50 символов, аналогично Cat)

**Конструкторы:**
- `Dog(string name)` - Создание собаки с указанным именем

**Методы:**
- `void Meow()` - Выводит "{Имя}: гав! (пытается мяукнуть)"
- `string ToString()` - Возвращает "собака: {Имя}"

**Особенности:**
- Реализует интерфейс `IMeowable` (полиморфизм)
- Валидация имени аналогична Cat
- Демонстрирует применение интерфейсов для разных классов

#### **Sounder.cs**
Вспомогательный класс для работы с коллекциями мяукающих объектов.

**Методы:**
- `void Meow(IEnumerable<IMeowable> meowers)` - Последовательно вызывает `Meow()` для каждого объекта в коллекции и логирует каждое мяуканье

**Особенности:**
- Работает с любыми объектами, реализующими `IMeowable`
- Интегрирует логирование через `MeowLogger`
- Проверка на null элементы коллекции

#### **MeowLogger.cs**
Статический класс для логирования и отслеживания статистики мяуканий.

**Основные методы:**
- `void LogMeow(IMeowable meower, int times = 1)` - Регистрирует мяуканья объекта в файл meow.log
- `Dictionary<string, int> ReadStatistics()` - Читает статистику из файла
- `void SaveStatistics(Dictionary<string, int> stats)` - Сохраняет статистику в файл (формат: "Тип|Имя;Количество")
- `void PrintAllStatistics()` - Выводит в консоль полную статистику всех мяукающих
- `void PrintStatisticsFor(IMeowable meower)` - Выводит статистику для конкретного объекта
- `void PrintStatisticsFor(string name)` - Выводит статистику для всех объектов с указанным именем
- `void ClearStatistics()` - Очищает файл статистики

**Приватные методы:**
- `string GetEntityName(IMeowable meower)` - Извлекает имя из ToString() объекта
- `void SaveStatistics(Dictionary<string, int> stats)` - Сохраняет данные в файл

**Особенности:**
- Использует файл meow.log в базовой директории приложения
- Поддерживает перегруженные методы для разной фильтрации статистики
- Валидация входных параметров (null check, диапазоны)
- Кэширование из файла при каждом чтении

### Модуль Fraction (Задание 2)

#### **IFraction.cs**
Интерфейс для расширенной функциональности дробей.

**Методы:**
- `double ToDouble()` - Получить вещественное представление дроби
- `void SetNumerator(int value)` - Установить числитель
- `void SetDenominator(int value)` - Установить знаменатель

#### **ICloneable.cs**
Интерфейс для клонирования объектов.

**Методы:**
- `object Clone()` - Возвращает глубокую копию объекта

#### **Fraction.cs**
Основной класс для работы с дробями.

**Свойства:**
- `int Numerator` - Числитель дроби (с индексатором для установки)
- `int Denominator` - Знаменатель дроби (с валидацией: не может быть 0 или отрицательным)
- `double? _valueCache` - Кэш вещественного значения (приватное)
- `bool _isDirty` - Флаг инвалидации кэша (приватное)

**Конструкторы:**
- `Fraction(int numerator, int denominator)` - Создание дроби с валидацией
- `Fraction(int integer)` - Создание целого числа как дроби (целое/1)

**Перегруженные операторы:**
- `Fraction + Fraction` - Сложение дробей
- `Fraction - Fraction` - Вычитание дробей
- `Fraction - int` - Вычитание целого числа из дроби
- `Fraction * Fraction` - Умножение дробей
- `Fraction / Fraction` - Деление дробей (с проверкой на деление на 0)
- `Fraction == Fraction` - Сравнение дробей по значению
- `Fraction != Fraction` - Неравенство дробей
- `implicit operator Fraction(int value)` - Неявное преобразование целого числа в дробь

**Методы-обёртки для цепочек:**
- `Fraction Sum(Fraction other)` - Эквивалент оператора +
- `Fraction Minus(Fraction other)` - Эквивалент оператора - (для другой дроби)
- `Fraction Minus(int value)` - Вычитание целого числа
- `Fraction Mult(Fraction other)` - Эквивалент оператора *
- `Fraction Div(Fraction other)` - Эквивалент оператора /

**Методы сравнения и хеширования:**
- `bool Equals(object? obj)` - Переопределённое сравнение по значениям (а/b == c/d)
- `int GetHashCode()` - Хеш-код на основе числителя и знаменателя
- `int CompareTo(Fraction other)` - Сравнение для сортировки

**Методы из интерфейсов:**
- `object Clone()` - Возвращает новый экземпляр Fraction с теми же значениями
- `double ToDouble()` - Возвращает вещественное представление с кэшированием
- `void SetNumerator(int value)` - Устанавливает числитель и пересчитывает
- `void SetDenominator(int value)` - Устанавливает знаменатель с валидацией

**Приватные вспомогательные методы:**
- `void NormalizeSign()` - Обеспечивает, что знаменатель всегда положительный
- `void Reduce()` - Сокращает дробь по НОД
- `static int GCD(int a, int b)` - Вычисляет наибольший общий делитель (алгоритм Евклида)

**Особенности:**
- Автоматическое сокращение дроби при создании
- Нормализация знака (минус всегда в числителе)
- Проверка деления на нулевую дробь
- Кэширование вещественного значения для оптимизации
- Валидация знаменателя (не может быть 0)
- Полная поддержка цепочечного вызова методов

### Утилиты

#### **Checker.cs**
Вспомогательный класс для валидации пользовательского ввода.

**Статические методы:**
- `int InputIntegerWithValidation(string message, int left = int.MinValue, int right = int.MaxValue, int? defaultValue = null)` 
  - Запрашивает целое число с проверкой диапазона
  - Поддерживает значение по умолчанию (при нажатии Enter)
  - Цветовой вывод ошибок (красный) и подсказок (жёлтый)

- `string InputStringWithValidation(string message, string? defaultValue = null, string allowedChars = defaultAllowedChars)`
  - Запрашивает строку с проверкой допустимых символов
  - По умолчанию разрешены: буквы (латина + кириллица), цифры, дефис, подчёркивание, запятая, пробел
  - Поддерживает значение по умолчанию
  - Цветовой вывод с подсказками

**Константы:**
- `defaultAllowedChars` - Набор допустимых символов (буквы, цифры, спецсимволы)

**Особенности:**
- Цветной вывод в консоль (жёлтый для подсказок, красный для ошибок)
- Кольцевой цикл ввода до получения корректных данных
- Валидация значения по умолчанию при инициализации
- XML-документация для каждого метода

## Примеры использования

### Создание и использование кота:
```csharp
Cat cat = new Cat("Барсик");
cat.Meow();           // Барсик: мяу!
cat.Meow(3);          // Барсик: мяу-мяу-мяу!
Console.WriteLine(cat.ToString()); // кот: Барсик
```

### Работа с коллекцией мяукающих:
```csharp
var meowers = new List<IMeowable>
{
    new Cat("Пушок"),
    new Dog("Шарик"),
    new Cat("Муся")
};
Sounder.Meow(meowers); // Выводит мяуканья и логирует статистику
```

### Операции с дробями:
```csharp
var f1 = new Fraction(1, 3);
var f2 = new Fraction(2, 3);
var result = f1 + f2;  // 1/1
Console.WriteLine(result); // "1/1"

// Цепочка методов
var chain = f1.Sum(f2).Mult(new Fraction(2)).Minus(1);
```

### Клонирование и кэширование:
```csharp
var original = new Fraction(7, 8);
var clone = (Fraction)original.Clone();

double value = clone.ToDouble(); // 0.875 (кэшируется)
clone.SetNumerator(3);
value = clone.ToDouble();        // Пересчитывается из-за _isDirty = true
```
